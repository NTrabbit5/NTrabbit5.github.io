<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> TeX_baitu blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      


<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-20221212-SPI协议详解"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/12/20221212-SPI%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/"
    >20221212-SPI协议详解</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/12/20221212-SPI%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time datetime="2022-12-12T11:58:24.000Z" itemprop="datePublished">2022-12-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/290620901">https://zhuanlan.zhihu.com/p/290620901</a></p>
<p>UART 没有时钟信号，无法控制何时发送数据，也无法保证双方按照完全相同的速度接收数据，因此，双方以不同的速度进行数据接收和发送，就会出现问题</p>
<p>如果要解决这个问题，uart 为每个字节添加额外的起始位和停止位，以帮助接收器在数据到达时进行同步</p>
<p>双方还必须事先就传输速度达成共识，设置相同的波特率 例如每秒9600位</p>
<p>传输速率如果有微小差异不是问题，因为接收器会在每个字节的开头重新同步</p>
<p>如果您注意到上图中的11001010不等于0x53，这是一个细节。串口协议通常会首先发送最低有效位，因此最小位在最左边LSB。低四位字节实际上是0011 &#x3D; 0x3，高四位字节是0101 &#x3D; 0x5。</p>
<p>异步串行工作得很好，但是在每个字节发送的时候都需要额外的起始位和停止位 以及在发送和接收数据所需的复杂硬件方面都有很多开销</p>
<p>不难发现，如果接收端和发送端设置的速度都不一致，那么接收到的数据将是垃圾 乱码</p>
<h2 id="SPI-通讯协议"><a href="#SPI-通讯协议" class="headerlink" title="SPI 通讯协议"></a>SPI 通讯协议</h2><p>spi 是一个同步的数据总线，也就是说它是用单独的数据线和一个单独的时钟信号来保证发送端和接收端的完美同步</p>
<p>时钟是一个振荡信号，它告诉接收端在确切的时机对数据线上的信号进行采样</p>
<p>产生时钟的一侧称为主机，另一侧为从机，总是只有一个主机 一般来说可以是微控制器 MCU 但是可以有多个从机</p>
<p>数据的采集时机可能是时钟信号的上升沿 或下降沿</p>
<p>具体要看对 spi 的配置</p>
<p>整体的传输大概可以分为以下几个过程</p>
<p>主机先将NSS 信号拉低，这样保证开始接收数据</p>
<p>当接收端检测到时钟的边沿信号时，它将立即读取数据线上的信号，这样就得到了一位数据 1bit</p>
<p>由于时钟是随数据一起发送的，因此指定数据的传输速度并不重要，尽管设备将具有可以运行的最高速度</p>
<p>主机发送到从机时：主机产生相应的时钟信号，然后数据一位一位地将从MOSI信号线上进行发送到从机；<br>主机接收从机数据：如果从机需要将数据发送回主机，则主机将继续生成预定数量的时钟信号，并且从机会将数据通过MISO信号线发送；</p>
<p>注意  spi 是全双工 具有单独的发送和接收线路，因此可以在同一时间发送和接收数据，另外 spi 的接收硬件可以是一个简单的移位寄存器，这笔异步串行通信所需的完整uart 要简单得多，并且更加便宜</p>
<p>spi 特性</p>
<p>spi 总线包括4条 逻辑线，定义如下</p>
<p>MISO 主机输入，从机输出，数据来自从机</p>
<p>MOSI 主机输出，从机输入</p>
<p>SCLK 串行时钟信号，由主机产生发送给从机</p>
<p>SS 片选信号，由主机发送，以控制与哪个从机通信，通常是低电平有效信号</p>
<p>其他制造商可能会遵循其他命名规则，但是最终他们指的相同的含义。以下是一些常用术语；</p>
<p>MISO也可以是SIMO，DOUT，DO，SDO或SO（在主机端）;<br>MOSI也可以是SOMI，DIN，DI，SDI或SI（在主机端）;<br>NSS也可以是CE，CS或SSEL;<br>SCLK也可以是SCK;<br>本文将按照以下命名进行讲解[MISO, MOSI, SCK，NSS]</p>
<p>时钟频率</p>
<p>SPI 总线上的主机必须在通信开始时候配置并生成相应的时钟信号，在每个SPI 时钟周期内，都会发生全双工数据传输</p>
<p>主机在mosi 线上发送一位数据，从机读取它，而从机在miso 线上发送一位数据，主机读取它</p>
<p>就算只进行单向的数据传输，也要保持这样的顺序，这就意味着无论接收任何数据，必须实际发送一些东西，在这种情况下，我们称其为虚拟数据</p>
<p>从理论上讲，只要实际可行，时钟速率就可以是您想要的任何速率，当然这个速率受限于每个系统能提供多大的系统时钟频率，以及最大的SPI传输速率。</p>
<p>时钟极性 CKP Clock Polarity</p>
<p>除了配置串行时钟频率 外，SPI 主设备还需要配置时钟极性</p>
<p>根据硬件制造商的命名规则不同，时钟极性通常写为CKP或CPOL。时钟极性和相位共同决定读取数据的方式，比如信号上升沿读取数据还是信号下降沿读取数据；</p>
<p>CKP 可以配置为1或0 ，这意味着您可以根据需要将时钟的默认状态 IDLE 设置为高或低，极性反转可以通过简单的逻辑逆变器实现，您必须参考设备的数据手册才能正确设置CKP 和CKE</p>
<p>CKP &#x3D; 0：时钟空闲IDLE为低电平0；<br>CKP &#x3D; 1：时钟空闲IDLE为高电平1；</p>
<p>时钟相位 CKE Clock Phase Edge</p>
<p>除配置串行时钟速率和极性外，SPI 主设备还应配置时钟相位，根据硬件制造商的不同，时钟相位通常写为CKE 或CPHA</p>
<p>顾明思义，时钟相位&#x2F;边沿，也就是采集数据时是在时钟信号的具体相位或者边沿</p>
<p>CKE &#x3D; 0 在时钟信号SCK 的第一个跳变沿采样</p>
<p>CKE &#x3D; 1 在时钟信号SCK 的第二个跳变沿采样</p>
<p>时钟配置总结</p>
<p>综上几种情况，下图总结了所有时钟配置组合，并突出显示了实际采样数据的时刻</p>
<p>其中黑色线为采样数据的时刻</p>
<p>蓝色线为SCK 时钟信号</p>
<p>具体如下图所示</p>
<p>模式编号</p>
<p>SPI 的时钟极性和相位的配置通常称为SPI 模式，所有可能的模式都遵循以下约定，具体如下表所示</p>
<p>除此之外，我们还应该仔细检查微控制器数据手册中包含的模式表，以确保一切正常</p>
<p>多从机模式</p>
<p>前面说到的SPI 总线必须有一个主机，可以有多个从机，那么具体连接到SPI 总线的方法有以下两种</p>
<p>第一种方法 多NSS</p>
<p>通常，每个从机都需要一条单独的SS 线</p>
<p>如果要和特定的从机进行通讯，可以将相应的NSS 信号线拉低，并保持其他NSS 信号线的状态为高电平，如果同时将两个NSS 信号线拉低，则可能会出现乱码，因为从机可能都试图在同一条MISO 线上传输数据，最终导致接收数据乱码</p>
<p>具体连接方式如下图所示</p>
<p>第二种方法 菊花链</p>
<p>在数字通信世界中，在设备信号 （总线信号或中断信号） 以串行的方式从一个设备依次传到下一个设备，不断循环直到数据到达目标设备的方式被称为菊花链</p>
<ol>
<li>菊花链的最大缺点是因为信号串行传输，所以一旦数据链路中的某设备发生故障的时候，它下面优先级较低的设备就不可能得到服务了</li>
</ol>
<p>另一方面，距离主机越远的从机，获得服务的优先级越低，所以需要安排好从机的优先级，并且设置总线检测器，如果某个从机超时，则对该从机进行短路，防止单个从机损坏造成整个链路崩溃的情况</p>
<p>具体的连接如下图所示</p>
<p>其中红线加粗为数据的流向</p>
<p>所以最终的数据流向图可以表示为</p>
<p>SCK 为时钟信号，8clks 表示8个边沿信号</p>
<p>其中D 为数据，X 为无效数据</p>
<p>所以不难发现，菊花链模式充分使用了SPI 其移位寄存器的功能，整个链充当通信移位寄存器，每个从机在下一个时钟周期将输入数据复制到输出</p>
<p>优缺点</p>
<p>SPI 通讯的优势</p>
<p>使SPI 作为串口通信接口脱颖而出的原因很多</p>
<p>全双工串行通信；<br>高速数据传输速率。<br>简单的软件配置；<br>极其灵活的数据传输，不限于8位，它可以是任意大小的字；<br>非常简单的硬件结构。从站不需要唯一地址（与I2C不同）。从机使用主机时钟，不需要精密时钟振荡器&#x2F;晶振（与UART不同）。不需要收发器（与CAN不同）。</p>
<p>SPI 的缺点 </p>
<p>没有硬件从机应答信号  主机可能在不知情的情况下无处发送</p>
<p>通常仅支持一个主设备</p>
<p>需要更多的引脚 与I2C 不同</p>
<p>没有定义硬件级别的错误检查协议</p>
<p>与RS232 和CAN 总线相比，只能支持非常短的距离</p>
<p>编程实现<br>下面是通过STM32的cubemx自动生成的HAL库代码，比较简单，截取了其中一部分，具体如下；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">MX_SPI1_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    hspi1.Instance = SPI1;</span><br><span class="line">    hspi1.Init.Mode = SPI_MODE_MASTER;    <span class="comment">//主机模式</span></span><br><span class="line">    hspi1.Init.Direction = SPI_DIRECTION_2LINES; <span class="comment">//全双工</span></span><br><span class="line">    hspi1.Init.DataSize = SPI_DATASIZE_8BIT;  <span class="comment">//数据位为8位</span></span><br><span class="line">    hspi1.Init.CLKPolarity = SPI_POLARITY_LOW;  <span class="comment">//CPOL=0</span></span><br><span class="line">    hspi1.Init.CLKPhase = SPI_PHASE_1EDGE;   <span class="comment">//CPHA为数据线的第一个变化沿</span></span><br><span class="line">    hspi1.Init.NSS = SPI_NSS_SOFT;     <span class="comment">//软件控制NSS</span></span><br><span class="line">    hspi1.Init.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_2;<span class="comment">//2分频，32M/2=16MHz</span></span><br><span class="line">    hspi1.Init.FirstBit = SPI_FIRSTBIT_MSB;   <span class="comment">//最高位先发送</span></span><br><span class="line">    hspi1.Init.TIMode = SPI_TIMODE_DISABLE;   <span class="comment">//TIMODE模式关闭</span></span><br><span class="line">    hspi1.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;<span class="comment">//CRC关闭</span></span><br><span class="line">    hspi1.Init.CRCPolynomial = <span class="number">10</span>;     <span class="comment">//默认值，无效</span></span><br><span class="line">    <span class="keyword">if</span> (HAL_SPI_Init(&amp;hspi1) != HAL_OK)    <span class="comment">//初始化</span></span><br><span class="line">    &#123;</span><br><span class="line">        _Error_Handler(__FILE__, __LINE__);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//发送数据</span></span><br><span class="line">HAL_StatusTypeDef  </span><br><span class="line"><span class="title function_">HAL_SPI_Transmit</span><span class="params">(SPI_HandleTypeDef *hspi, </span></span><br><span class="line"><span class="params">                 <span class="type">uint8_t</span> *pData, </span></span><br><span class="line"><span class="params">                 <span class="type">uint16_t</span> Size, </span></span><br><span class="line"><span class="params">                 <span class="type">uint32_t</span> Timeout)</span>;</span><br><span class="line"><span class="comment">//接收数据</span></span><br><span class="line">HAL_StatusTypeDef  </span><br><span class="line"><span class="title function_">HAL_SPI_Receive</span><span class="params">(SPI_HandleTypeDef *hspi, </span></span><br><span class="line"><span class="params">                <span class="type">uint8_t</span> *pData, </span></span><br><span class="line"><span class="params">                <span class="type">uint16_t</span> Size, </span></span><br><span class="line"><span class="params">                <span class="type">uint32_t</span> Timeout)</span>;</span><br></pre></td></tr></table></figure>

<p>% SPI、UART、RS232、RS485、IIC 5</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221212-RS2329针串口定义"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/12/20221212-RS2329%E9%92%88%E4%B8%B2%E5%8F%A3%E5%AE%9A%E4%B9%89/"
    >20221212-RS2329针串口定义</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/12/20221212-RS2329%E9%92%88%E4%B8%B2%E5%8F%A3%E5%AE%9A%E4%B9%89/" class="article-date">
  <time datetime="2022-12-12T11:43:43.000Z" itemprop="datePublished">2022-12-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>电脑 9 针串口<br>电脑串口引脚定义<br>这里写图片描述<br>按序号说明：<br>1 载波检测(DCD)<br>2 接受数据(RXD)<br>3 发出数据(TXD)<br>4 数据终端准备好(DTR)<br>5 信号地线(SG)<br>6 数据准备好(DSR)<br>7 请求发送(RTS)<br>8 清除发送(CTS)<br>9 振铃指示(RI)<br>串口母头连接器的管脚定义<br>这里写图片描述<br>此上为计算机串口管脚定义说明。<br>1、 RS-232C 母接头定义(9 芯)：<br>这里写图片描述<br>注意图和总引脚的标号。<br>针脚 定义 符号<br>1 载波检测 DCD<br>2 接收数据 RXD<br>3 发送数据 TXD<br>4 数据终端准备好 DTR<br>5 信号地 SG<br>6 数据准备好 DSR<br>7 请求发送 RTS<br>8 清除发送 CTS<br>9 振铃提示 RI<br>Pin 1 Received Line Signal Detector(Data Carrier Detect)<br>Pin 2 Received Data<br>Pin 3 Transmit Data<br>Pin 4 Data Terminal Ready<br>Pin 5 Signal Ground<br>Pin 6 Data Set Ready<br>Pin 7 Request To Send<br>Pin 8 Clear To Send<br>Pin 9 Ring Indicator</p>
<p>2、 RS-232C 母接头定义(25 芯)<br>针脚 定义 符号<br>1 频蔽地线<br>2 发送数据 TXD<br>3 接收数据 RXD<br>4 请求发送 RTS<br>5 允许发送 CTS<br>6 数据准备好 DSR<br>7 信号地 SG<br>8 载波检测 DCD<br>9 发送返回(+)<br>10 未定义<br>11 数据发送(-)<br>12<del>17 未定义<br>18 数据接收(+)<br>19 未定义<br>20 数据终端准备好 DTR<br>21 未定义<br>22 振铃 RI<br>23</del>24 未定义<br>25 接收返回(-)<br>Pin 1 Protective Ground<br>Pin 2 Transmit Data<br>Pin 3 Received Data<br>Pin 4 Request To Send<br>Pin 5 Clear To Send<br>Pin 6 Data Set Ready<br>Pin 7 Signal Ground<br>Pin 8 Received Line Signal Detector<br>(Data Carrier Detect)<br>Pin 20 Data Terminal Ready<br>Pin 22 Ring Indicator<br>RS-232C,25 芯针转换为 9 芯针<br>这里写图片描述</p>
<p><strong>二、 补充 （几个小时的查询和求助才弄明白的，呵呵，珍贵<br>啊）</strong><br>1.RX232 公接头的图片和引脚编号 ：<br>这里写图片描述<br>2.从两个图可以看出， 公接头和母接头相连时 rx-rx，<br>tx-tx，进而可知下载线的两端接口本应该 rx-rx、t<br>x-tx 的，但买串口线时需要买交叉串口线（实现 RX-<br>tx 的连接），进而实现一段发送一段接收。<br>三、更详细的引脚标号规则（超准）<br>DB9 Male (Pin Side) DB9 Female (Pin Side)<br>DB9 Female (Solder Side) DB9 Male (Solder Side)<br>这里写图片描述<br>1 ，RS232 的定义：<br>RS-232 串行接口标准详细介绍<br>目前 RS-232 是 PC 机与通信工业中应用最广泛的一种串行接口。RS-232 被定义为一种在低速率串<br>行通讯中增加通讯距离的单端标准。RS-232 采取不平衡传输方式，即所谓单端通讯。<br>这里写图片描述<br>图一<br>在 RS-232 的通讯标准中是以一个 25 针的接口来定义的，并在早期的计算机如 PC 或 XT 机型上广<br>泛使用，但在 AT 机以后的机型上，实际均采用了 9 针的简化版本应用，现在所说的 232 通讯均默认为 9<br>针的接口。图一显示了 9 针通讯的接口管脚名称，以下是各管脚的说明：<br>这里写图片描述<br>现在通常计算机均配有这种标准的 232 接口，通常这种接口用于联接鼠标、MODEM 或打印机等外<br>部设备。<br>实际应用中，电子工程师在设计计算机与外围设备的通信时，通常在 9 针的基础再进行简化，只用<br>其中的 2、3、5 三个管脚进行通信。这三个管脚分别是接收线、发送线和地线，在一般情况下即可满足通<br>讯的要求，计算机和外部通讯的接线方法如图二：<br>这里写图片描述<br>值得注意的是，图二中 2、3 两脚是交叉互联的，这很容易理解，因为一个设备的发送线必须联接到<br>另外一台设备的接收线上，反之亦然。<br>对于 232 信号的电器特性等知识，在这里无法详细解说，有兴趣的话可以去网站查阅这方面的文章，<br>232 是最常用的通信方式之一，大量应用于各种工业控制或电子家电等产品中，是电子工程师必须掌握的<br>知识之一。<br>另外说明一下，232 信号的有效通讯距离是 15M。<br>2.RS232 TO TTL 电路：</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221212-蓝牙协议分析"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/12/20221212-%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/"
    >20221212-蓝牙协议分析</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/12/20221212-%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2022-12-12T09:26:15.000Z" itemprop="datePublished">2022-12-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/482020575">https://zhuanlan.zhihu.com/p/482020575</a></p>
<p>本文介绍蓝牙协议的基本特点，版本演进，协议的构成，学习路线等基础知识分享</p>
<p>​ 蓝牙（英语：Bluetooth），一种无线通讯技术标准，用来让固定与移动设备，在短距离间交换资料，以形成个人局域网（PAN）。其使用短波特高频（UHF）无线电波，经由2.4至2.485 GHz的ISM频段来进行通信。1994年由电信商爱立信（Ericsson）发展出这个技术。它最初的设计，是希望创建一个RS-232数据线的无线通信替代版本。它能够链接多个设备，克服同步的问题。</p>
<p>技术类型 </p>
<p>蓝牙技术分为 基础率 增强数据率，和低功耗 LE 两种技术类型，其中 、BR EDR 是以点对点网络拓扑结构创建一对一设备通信 LE 型则使用点对点 一对一 广播 一对多和网格 多对多 等多种网络拓扑结构</p>
<p>蓝牙技术联盟（英语：Bluetooth Special Interest Group，缩写为SIG）拥有蓝牙的商标，负责制定蓝牙规范、认证制造厂商，授权他们使用蓝牙技术与蓝牙标志，但本身不负责蓝牙设备的设计、生产及贩售。</p>
<p>蓝牙 2.x EDR<br>加入了非跳跃窄频通道，因为不需要与每个设备交换应答信号，这种通道可以用来将给中器件的蓝牙服务概要同时广播到巨量的蓝牙器件，应答信号交换过程当前需要大约一秒，实时公共交通的时刻表，基本的交通畅通性信息和高级交通指向指示灯未加密信息可以以高速度发送给设备，更高的连接速度，支持多个速度水平 </p>
<p>​ 2007年7月26日，蓝牙技术联盟通过了蓝牙核心规范2.1+EDR，向下对1.2版本完全兼容，并增加了Sniff省电功能，使得适配器与设备的联系时间延长到0.5秒，能节约不小电量；增强功能有简单安全配对（SSP），这改善了蓝牙设备的配对经验，同时提升了使用和安全强度。</p>
<p>蓝牙 3.0 HS</p>
<p>是一种全新的交替射频技术，蓝牙3.0 + HS 提高了资料传输速率，集成802.11 PAL 最高速度可达24Mbps 此外引入了增强电源控制，实际空闲功耗明显降低</p>
<p>蓝牙 4.x </p>
<p>提出了低功耗蓝牙 传统蓝牙 和高速蓝牙  三种模式</p>
<p>高速蓝牙 主攻数据交换与传输</p>
<p>传统蓝牙 则以信息沟通，设备连接为重点</p>
<p>低功耗蓝牙 以不需要占用太多带宽的设备连接为主，</p>
<p>这三种协议规范还能够互相组合搭配，从而实现更广泛的应用模式，此外，Bluetooth 4.0 还包蓝牙的传输距离提升到100米以上  低功耗模式调条件下</p>
<p>调频 使用所有蓝牙规范版本通用的自适应调频，最大程度地减少 和其他 2.4GHz ISM 频段无线技术的串扰</p>
<p>蓝牙 5.x </p>
<p>在有效传输距离上将是4.2 LE 版本的4倍 传输速度将是4.2LE 版本的2倍 </p>
<p>蓝牙5.0 还支持室内定位导航功能，允许无需配对接受信标的数据 ，针对物联网进行了很多底层优化</p>
<p>1.6 总结 </p>
<p>我们常说的蓝牙4.0 不等同于BLE BLE 只是蓝牙4.0 的子集，蓝牙4.0 是一个综合性协议规范</p>
<p>蓝牙4.0 版本以后技术模式上分为低功耗蓝牙 和经典蓝牙 两种，市场芯片多数为仅支持BLE 的，也有两者都支持的 双模蓝牙芯片</p>
<p>蓝牙芯片的三种功能配置 </p>
<ol start="2">
<li>蓝牙协议栈</li>
</ol>
<p>蓝牙协议栈由主机 +HCI 可选 +控制器三大块组成，其中对于单芯片方案是没用HCI 的 </p>
<p>主机 Host 主机部分由核心协议层 和核心规范构成</p>
<p>控制器 此部分拆分为低功耗蓝牙和经典蓝牙两个章节说明</p>
<p>HCI 此部分定义了主机和控制器之间通信的接口标准，可以是UART USB 等通信方式 </p>
<p>上图中红色部分是 BR&#x2F;RED 经典蓝牙的必选项，绿色部分是LE 低功耗蓝牙必选项，蓝色部分是公共部分，当然经典蓝牙也可以具备绿色部分特性，HCI 接口根据芯片架构有关，是可选项，两者在物理层的差异性图中没有体现，不涉及芯片设计，这块可暂不关注 </p>
<p>GPA 规范，通用接入规范，定义了所有蓝牙设备的基础功能，设备键发现，连接、配对，绑定的流程，蓝牙设备中四种角色，广播和扫描响应报文的格式，还有一些通用蓝牙参数定义，比如设备地址，名称、配对密钥和设备的外观特征值，用于区分是什么设备，手机还是电脑；明确了作为一个低功耗蓝牙设备的基本需求，包含哪些层级以及如何协同工作的，规范了一些通用的蓝牙参数，蓝牙设备地址、设备名称、配对密钥、外观特征值  用于区分是手机还是电脑</p>
<p>ATT 属性协议，定义了访问对端设备上数据的一组规则，是GATT 规范的基础，也是低功耗蓝牙的基石，定义了host 端属性报文格式和报文类型</p>
<p>GATT 通用属性规范，位于ATT 之上，定义了属性的类型及其使用方法，GATT 用来规范attribute 中的数据内容，并运用 group 的概念对attribute 进行分类管理，没有GATT BLE 协议栈也能跑，但互联互通就会出现问题</p>
<p>L2CAP 层，屏蔽了控制器传输协议中的许多特性，方便高层协议的开发，报文分片和重组，SAR 流控，重传 报文完整性校验等</p>
<p>SMP 安全管理协议，定义了蓝牙设备配对，认证，解密等行为的安全操作</p>
<p>LLCP LL 链路层控制，</p>
<p>PHY 物理层，低功耗蓝牙采用40个信道，分为数据信道和广播信道；广播信道占用3个，用于发现设备、建立连接、广播数据；数据信道占用37个，用于已建立连接设备间的数据通信。建立连接的两个设备，必须同一时间处于同一信道上才能通信。</p>
<ol start="3">
<li>学习路线</li>
</ol>
<p>此部分给出低功耗蓝牙的基本学习路线，不一定适合所有人</p>
<p>初步理解协议栈基本组成、专业术语，对协议栈有整体的认识。<br>结合相关项目抓包分析，结合理论和实际表现分析每个子过程，比如ble广播功能、ble建立连接等。有条件的可以整个开发板，都有配套教程代码，可以直接运行的。<br>相关协议栈源码移植和学习，推荐Zephyr.<br>4. 协议文档<br>蓝牙联盟官方下载入口：<a target="_blank" rel="noopener" href="http://www.bluetooth.com/">http://www.bluetooth.com</a><br>个人网盘分享：<a target="_blank" rel="noopener" href="https://www.aliyundrive.com/s/dhKyo">https://www.aliyundrive.com/s/dhKyo</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221212-MQTT协议笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/12/20221212-MQTT%E5%8D%8F%E8%AE%AE%E7%AC%94%E8%AE%B0/"
    >20221212-MQTT协议笔记</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/12/20221212-MQTT%E5%8D%8F%E8%AE%AE%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2022-12-12T08:18:48.000Z" itemprop="datePublished">2022-12-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/mqtt-intro.html">https://www.runoob.com/w3cnote/mqtt-intro.html</a></p>
<p>MQTT 入门介绍</p>
<p>MQTT 消息队列遥测传输协议，是一种基于发布&#x2F;订阅模式的轻量级 通讯协议，该协议构建于TCP&#x2F;IP 协议上，由IBM 在1999年发布，MQTT 最大优点在于，可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务，作为一种低开销，低带宽占用的即时通讯协议，使其在物联网、小型设备、移动应用等方面有较广泛的应用</p>
<p>MQTT 是一个基于客户端-服务器的消息发布&#x2F;订阅传输协议。MQTT协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛。在很多情况下，包括受限的环境中，如：机器与机器（M2M）通信和物联网（IoT）。其在，通过卫星链路通信传感器、偶尔拨号的医疗设备、智能家居、及一些小型化设备中已广泛使用。</p>
<p>二、设计规范</p>
<p>由于物联网的环境是非常特别的，所以MQTT 遵循以下设计原则</p>
<p>精简，不添加有可无的功能</p>
<p>发布&#x2F;订阅 模式，方便消息在传感器之间传递</p>
<p>允许用户动态创建主题，零运维成本</p>
<p>把传输量降到最低以提高传输效率</p>
<p>把低带宽、高延迟、不稳定的网络等因素考虑在内</p>
<p>支持连续的会话控制</p>
<p>理解客户端计算能力可能很低</p>
<p>提供服务质量管理</p>
<p>假设数据不可知，不强求传输数据的类型与格式，保持灵活性</p>
<h2 id="三、主要特性"><a href="#三、主要特性" class="headerlink" title="三、主要特性"></a>三、主要特性</h2><p>MQTT 协议工作在低带宽、不可靠的网络的远程传感器和控制设备通讯而设计的协议，它具有以下主要的几项特性。</p>
<p>使用发布&#x2F;订阅消息模式，提供一对多的消息发布，解除应用程序耦合</p>
<p>这一点很类似于XMPP，但是MQTT 的信息冗余远小于XMPP，因为XMPP 使用XML 格式文本来传递数据</p>
<p>对负载内容屏蔽的消息传输</p>
<p>使用TCP&#x2F;IP提供网络连接</p>
<p>主流的MQTT 是基于TCP 连接进行数据推送的，但是同样有基于UDP 的版本，叫做MQTT-SN 这两种版本由于基于不同的连接方式，优缺点自然也就各有不同了</p>
<p>有三种消息发布服务质量</p>
<p>至多一次，消息发布完全依赖底层TCP&#x2F;IP 网络，会发生消息丢失或重复，这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送，这一种方式主要普通APP 的推送，倘若你的智能设备在消息推送时未联网，推送过去没收到，再次联网也就收不到了</p>
<p>至少一次，确保消息到达，但消息重复可能会发生</p>
<p>只有一次，确保消息到达一次。在一些要求比较严格的计费系统中，可以使用此级别，在计费系统中，消息重复或丢失会导致不正确的结果，这种最高质量的消息发布服务还可以用于即时通讯类的app 的推送，确保用户收到且只会收到一次</p>
<p>小型传输，开销很小，协议交换最小化，以降低网络流量。这就是为什么在介绍里说它非常适合  在物联网领域，传感器与服务器的通信，信息的收集，要知道嵌入式设备的运算能力和带宽都相对薄弱，使用这种协议来传递消息再适合不过了</p>
<p>使用 last will 和testament特性通知有关各客户端异常中断的机制</p>
<p>last will  即遗言机制，用于同位置同一主题下的其他设备发送遗言的设备已经断开了连接</p>
<p>testament  医嘱机制，功能类似于  last will </p>
<p>MQTT 协议原理 </p>
<p>实现MQTT 协议需要客户端和服务器端通讯完成，在通讯过程中，MQTT 协议中有三种身份 发布者，代理，服务器，订阅者，其中，消息的发布者和订阅者都是客户端，消息代理是服务器，消息发布者可以同时是订阅者</p>
<p>MQTT 传输的消息分为，主题，和负载 两部分</p>
<p>topic 可以理解为消息的类型，订阅者订阅后，就会收到该主题的消息内容</p>
<p>payload 可以理解为消息的内容，是指订阅者具体要使用的内容</p>
<p>4.2 网络传输与应用消息</p>
<p>MQTT 会构建底层网络传输，它将建立客户端到服务器的连接，提供两者之间的一个有序的、无损的、基于字节流的双向传输</p>
<p>当应用数据通过MQTT 网络发送时，MQTT 会把与之相关的服务质量和主题名 相关连</p>
<p>MQTT 客户端</p>
<p>一个使用MQTT 协议的应用程序或者设备，它总是建立到服务器的网络连接，客户端可以</p>
<p>发布其他客户端可能会订阅的信息</p>
<p>订阅其他客户端发布的消息</p>
<p>退订或删除应用程序的消息</p>
<p>断开与服务器连接</p>
<p>4.4 MQTT 服务器</p>
<p>MQTT 服务器以称为消息代理，可以是一个应用程序或一台设备，它是位于消息发布者和订阅者之间，它可以</p>
<p>接受来自客户的网络连接</p>
<p>接受客户发布的应用信息</p>
<p>处理来自客户端的订阅和退订请求</p>
<p>向订阅的客户转发应用程序消息</p>
<p>4.5 MQTT 协议中的订阅、主题、会话</p>
<p>订阅 </p>
<p>订阅包含主题筛选器 和最大服务质量，订阅会与一个会话关联，一个会话可以包含多个订阅，每一个会话中的每个订阅都有一个不同的主题筛选器</p>
<p>会话</p>
<p>每个客户端与服务器建立连接后就是一个会话，客户端和服务器之间有状态交互，会话存在于一个网络之间，也可能在客户端和服务器之间跨越多个连续的网络连接、</p>
<p>主题名</p>
<p>连接到一个应用程序消息的标签，该标签与服务器的订阅相匹配，服务器会将消息发送给订阅所匹配标签的每个客户端</p>
<p>主题筛选器</p>
<p>一个对主题名通配符筛选器，在订阅表达式中使用，表示订阅所匹配到的多个主题</p>
<p>负载</p>
<p>消息订阅者所具体接收的内容</p>
<p>MQTT 协议中的方法</p>
<p>MQTT 协议中定义了一些方法 也被称为动作，来于表示对确定资源所进行操作，这个资源可以代表预先存在的数据或动态生成数据，这取决于服务器的实现，通常来说，资源指服务器上的文件或输出，主要方法有</p>
<p>connect 等待与服务器建立连接</p>
<p>disconnect 等待MQTT 客户端完成所做的工作，并与服务器断开TCP&#x2F;IP 会话</p>
<p>subscribe 等待完成订阅</p>
<p>unsubscribe 等待服务器取消客户端的一个或多个topics 订阅 </p>
<p>publish MQTT 客户端发送消息请求，发送完成后返回应用程序线程</p>
<p>MQTT 协议数据包结构</p>
<p>在MQTT 协议中，一个MQTT 数据包由固定头，可变头，消息体 三部分构成，MQTT 数据包结构如下</p>
<p>固定头 fixed header  存在于所有MQTT 数据包中，表示数据包类型及数据包的分组类表示</p>
<p>可变头  存在于部分MQTT 数据包中，数据包类型 决定了可变头是否存在及其具体内容</p>
<p>消息体 pyload  存在于部分MQTT 数据包中，表示客户端收到的具体内容</p>
<p>MQTT 固定头  </p>
<p>固定头存在于所有MQTT 数据包中，其结构如下</p>
<p>MQTT 数据包类型 </p>
<p>位置byte1 中bits 7-4 </p>
<p>相当于一个4位的无符号值，类型，取值及描述如下</p>
<p>标识位</p>
<p>在不使用标识位的消息类型中，标识位被作为保留位，如果收到无效的标志时，接收端必须关闭网络连接</p>
<p>DUP 发布消息 的副本，用来在保证消息的可靠传输，如果设置为1  则在下面的变长中增加 messageid 并且需要回复确认，以保证消息传输完成，但不能用于检测消息重复发送</p>
<p>QoS 发布消息的服务质量，即：保证消息传递的次数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Ø00：最多一次，即：&lt;=1</span><br><span class="line"></span><br><span class="line">Ø01：至少一次，即：&gt;=1</span><br><span class="line"></span><br><span class="line">Ø10：一次，即：=1</span><br><span class="line"></span><br><span class="line">Ø11：预留</span><br></pre></td></tr></table></figure>

<p>RETAIN 发布保留标识，表示服务器要保留这次推送的信息，如果有新的订阅者出现，就把消息推送给它，如果没有那么推送至当前订阅者后释放</p>
<p>剩余长度</p>
<p>固定头的第二字节用来保存变长头部和消息体的总大小，但不是直接保存的，这一字节是可以扩展的，其保存机制，前7位用于保存长度，后一部用作标识，当最后一位为1时，表示长度不足，需要使用两个字节继续保存，例如，计算出后面的大小为0 </p>
<p>MQTT 可变头 </p>
<p>MQTT 数据包中包含一个可变头，它驻位于固定的头和负载之间，可变头的内容因数据包类型而不同，较常的应用是作为包的标识</p>
<p>很多类型数据包中都包括一个2字节的数据包标识字段，这些类型的包有</p>
<p>PUBLISH (QoS &gt; 0)、PUBACK、PUBREC、PUBREL、PUBCOMP、SUBSCRIBE、SUBACK、UNSUBSCRIBE、UNSUBACK。</p>
<p>Payload 消息体 </p>
<p>payload 消息体位MQTT 数据包的第三部分，包含 connect subscribe  subback unsubscribe 四种类型的消息</p>
<p>connect 消息体内容主要是客户端的clientID 订阅的topic message 以及用户名和密码 </p>
<p>subscribe 消息体内容是一系列的要订阅的主题以及QoS</p>
<p>suback 消息体内容是服务器对于subscribe 所申请的主题及QoS 进行确认和回复</p>
<p>unsubscribe  消息体内容是要订阅的主题</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221212-贪吃蛇小游戏"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/12/20221212-%E8%B4%AA%E5%90%83%E8%9B%87%E5%B0%8F%E6%B8%B8%E6%88%8F/"
    >20221212-贪吃蛇小游戏</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/12/20221212-%E8%B4%AA%E5%90%83%E8%9B%87%E5%B0%8F%E6%B8%B8%E6%88%8F/" class="article-date">
  <time datetime="2022-12-12T04:59:14.000Z" itemprop="datePublished">2022-12-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;conio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> H 23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> W 75</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WAIT_TIME 500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义direction的每个值代表的方向</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UP 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DOWN 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[H][W];        <span class="comment">//地图数组</span></span><br><span class="line"><span class="type">int</span> s[H*W][<span class="number">2</span>];      <span class="comment">//蛇身坐标数组</span></span><br><span class="line"><span class="type">int</span> sLength;        <span class="comment">//蛇的长度</span></span><br><span class="line"><span class="type">int</span> direction;      <span class="comment">//蛇的方向</span></span><br><span class="line"><span class="type">bool</span> eated=<span class="literal">false</span>;   <span class="comment">//标记是否吃到食物</span></span><br><span class="line"><span class="type">int</span> score=<span class="number">0</span>;        <span class="comment">//得分</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span>         <span class="comment">//程序开始时的初始化操作</span></span><br><span class="line">&#123;</span><br><span class="line">    srand((<span class="type">unsigned</span>)time(<span class="literal">NULL</span>));            <span class="comment">//设置随机数种子为现在的时间</span></span><br><span class="line">    CONSOLE_CURSOR_INFO cursor_info = &#123;<span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &amp;cursor_info);    <span class="comment">//隐藏关标</span></span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;H; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a[i][<span class="number">0</span>]=<span class="number">1</span>;          <span class="comment">//让第一列为1</span></span><br><span class="line">        a[i][W<span class="number">-1</span>]=<span class="number">1</span>;        <span class="comment">//让最后一列为1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">0</span>; j&lt;W; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        a[<span class="number">0</span>][j]=<span class="number">1</span>;      <span class="comment">//让第一行为1</span></span><br><span class="line">        a[H<span class="number">-1</span>][j]=<span class="number">1</span>;    <span class="comment">//让最后一行为1</span></span><br><span class="line">    &#125;</span><br><span class="line">    sLength=<span class="number">4</span>;          <span class="comment">//让蛇的最初长度为4</span></span><br><span class="line">    s[<span class="number">0</span>][<span class="number">0</span>]=H/<span class="number">2</span>;</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">1</span>]=W/<span class="number">2</span>;        <span class="comment">//给蛇头坐标赋值</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i][<span class="number">0</span>]=s[<span class="number">0</span>][<span class="number">0</span>]+i;</span><br><span class="line">        s[i][<span class="number">1</span>]=s[<span class="number">0</span>][<span class="number">1</span>];  <span class="comment">//给刚开始的蛇身几个初始坐标</span></span><br><span class="line">    &#125;</span><br><span class="line">    direction=UP;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">gotoxy</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span>        <span class="comment">//移动光标</span></span><br><span class="line">&#123;</span><br><span class="line">    COORD position= &#123;j,i&#125;;</span><br><span class="line">    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE),position);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> ii,<span class="type">int</span> jj)</span>        <span class="comment">//判断这个点能不能放食物，可以放返回1，不能放返回0</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(a[ii][jj]==<span class="number">1</span>)        <span class="comment">//如果有障碍物，返回0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;sLength; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ii==s[i][<span class="number">0</span>]&amp;&amp;jj==s[i][<span class="number">1</span>])      <span class="comment">//如果和其中一个蛇身重合，就返回0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ii==<span class="number">0</span>||ii==H<span class="number">-1</span>||jj==<span class="number">0</span>||jj==W<span class="number">-1</span>)      <span class="comment">//如果在边界上面，返回0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;                       <span class="comment">//最后筛选 过后的是符合条件的点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">food</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        i=rand()%H;                 <span class="comment">//生成0~H-1之间的一个数</span></span><br><span class="line">        j=rand()%W;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(check(i,j)==<span class="number">0</span>);           <span class="comment">//生成点直到满足条件</span></span><br><span class="line">    a[i][j]=<span class="number">-1</span>;                     <span class="comment">//标记为食物</span></span><br><span class="line">    gotoxy(i,j);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;$&quot;</span>);                    <span class="comment">//画出食物</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawMap</span><span class="params">()</span>                  <span class="comment">//画地图</span></span><br><span class="line">&#123;</span><br><span class="line">    gotoxy(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;H; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>; j&lt;W; j++)          <span class="comment">//两重for循环遍历数组</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][j]==<span class="number">0</span>)          <span class="comment">//为0输出空格</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="keyword">else</span>                    <span class="comment">//为1输出#</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);               <span class="comment">//别忘了换行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">move</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    gotoxy(s[sLength<span class="number">-1</span>][<span class="number">0</span>],s[sLength<span class="number">-1</span>][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);                            <span class="comment">//在尾巴上面画空格以擦除尾巴</span></span><br><span class="line">    <span class="keyword">if</span>(eated)               <span class="comment">//如果吃到了食物</span></span><br><span class="line">    &#123;</span><br><span class="line">        sLength++;</span><br><span class="line">        eated=<span class="literal">false</span>;        <span class="comment">//设置为false，不然无限变长</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(i=sLength<span class="number">-1</span>; i&gt;<span class="number">0</span>; i--)  <span class="comment">//从尾巴开始，每一个点的位置等于它前面一个点的位置</span></span><br><span class="line">    &#123;</span><br><span class="line">        s[i][<span class="number">0</span>]=s[i<span class="number">-1</span>][<span class="number">0</span>];</span><br><span class="line">        s[i][<span class="number">1</span>]=s[i<span class="number">-1</span>][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span>(direction)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> UP:</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">0</span>]--;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DOWN:</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">0</span>]++;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LEFT:</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">1</span>]--;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> RIGHT:</span><br><span class="line">        s[<span class="number">0</span>][<span class="number">1</span>]++;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawSnake</span><span class="params">()</span>                <span class="comment">//画蛇</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;sLength; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        gotoxy(s[i][<span class="number">0</span>],s[i][<span class="number">1</span>]);        <span class="comment">//移动关标到蛇的坐标</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;@&quot;</span>);                    <span class="comment">//在这个位置画蛇</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(kbhit()!=<span class="number">0</span>)          <span class="comment">//如果有键盘输入</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> in;</span><br><span class="line">        <span class="keyword">while</span>(!kbhit()==<span class="number">0</span>)  <span class="comment">//如果玩家输入了多个按键，以最后一个按键为准</span></span><br><span class="line">            in=getch();</span><br><span class="line">        <span class="keyword">switch</span>(in)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(direction!=DOWN)         <span class="comment">//不能缩头吧。。。。</span></span><br><span class="line">                direction=UP;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(direction!=UP)</span><br><span class="line">                direction=DOWN;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(direction!=RIGHT)</span><br><span class="line">                direction=LEFT;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(direction!=LEFT)</span><br><span class="line">                direction=RIGHT;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;P&#x27;</span>:</span><br><span class="line">            gotoxy(H,<span class="number">0</span>);        <span class="comment">//将光标移动到下面</span></span><br><span class="line">            system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">            gotoxy(H,<span class="number">0</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;                   &quot;</span>);  <span class="comment">//消去下面的按任意键继续</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">gameOver</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">bool</span> isGameOver=<span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> sX=s[<span class="number">0</span>][<span class="number">0</span>],sY=s[<span class="number">0</span>][<span class="number">1</span>];      <span class="comment">//蛇头的x坐标和y坐标</span></span><br><span class="line">    <span class="keyword">if</span>(sX==<span class="number">0</span>||sX==H<span class="number">-1</span>||sY==<span class="number">0</span>||sY==W<span class="number">-1</span>)</span><br><span class="line">        isGameOver=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;sLength; i++)    <span class="comment">//判断有没有吃到自己</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i][<span class="number">0</span>]==sX&amp;&amp;s[i][<span class="number">1</span>]==sY)</span><br><span class="line">            isGameOver=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isGameOver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printScore</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    gotoxy(<span class="number">0</span>,W+<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  贪吃蛇小游戏&quot;</span>);</span><br><span class="line">    gotoxy(<span class="number">1</span>,W+<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  TeX白兔 制作&quot;</span>);</span><br><span class="line">    gotoxy(<span class="number">4</span>,W+<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;  得分:%d&quot;</span>,score);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    init();                     <span class="comment">//程序开始时的初始化操作</span></span><br><span class="line">    drawMap();                  <span class="comment">//画地图</span></span><br><span class="line">    food();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        drawSnake();                <span class="comment">//画蛇</span></span><br><span class="line">        printScore();</span><br><span class="line">        Sleep(WAIT_TIME);           <span class="comment">//等待一段时间</span></span><br><span class="line">        key();</span><br><span class="line">        move();                     <span class="comment">//移动蛇（主要是修改蛇身数组的数据）</span></span><br><span class="line">        <span class="keyword">if</span>(gameOver())</span><br><span class="line">        &#123;</span><br><span class="line">            system(<span class="string">&quot;cls&quot;</span>);          <span class="comment">//清除屏幕内容</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Game Over\n&quot;</span>);</span><br><span class="line">            system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a[s[<span class="number">0</span>][<span class="number">0</span>]][s[<span class="number">0</span>][<span class="number">1</span>]]==<span class="number">-1</span>) <span class="comment">//如果蛇头碰到食物，就重新投放食物，并且把食物点重置为0</span></span><br><span class="line">        &#123;</span><br><span class="line">            eated=<span class="literal">true</span>;             <span class="comment">//标记已经吃到食物</span></span><br><span class="line">            score+=<span class="number">10</span>;</span><br><span class="line">            food();</span><br><span class="line">            a[s[<span class="number">0</span>][<span class="number">0</span>]][s[<span class="number">0</span>][<span class="number">1</span>]]=<span class="number">0</span>;  <span class="comment">//去掉食物</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221203-《登泰山记》"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/03/20221203-%E3%80%8A%E7%99%BB%E6%B3%B0%E5%B1%B1%E8%AE%B0%E3%80%8B/"
    >20221203-《登泰山记》</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/03/20221203-%E3%80%8A%E7%99%BB%E6%B3%B0%E5%B1%B1%E8%AE%B0%E3%80%8B/" class="article-date">
  <time datetime="2022-12-03T12:09:59.000Z" itemprop="datePublished">2022-12-03</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>《登泰山记》</p>
<p>姚鼐 〔清代〕</p>
<p>泰山之阳，汶水西流；其阴，济水东流。阳谷皆入汶，阴谷皆入济。当其南北分者，古长城也。最高日观峰，在长城南十五里。</p>
<p>余以乾隆三十九年十二月，自京师乘风雪，历齐河、长清，穿泰山西北谷，越长城之限，至于泰安。是月丁未，与知府朱孝纯子颍由南麓登。四十五里，道皆砌石为磴，其级七千有余。泰山正南面有三谷。中谷绕泰安城下，郦道元所谓环水也。余始循以入，道少半，越中岭，复循西谷，遂至其巅。古时登山，循东谷入，道有天门。东谷者，古谓之天门溪水，余所不至也。今所经中岭及山巅，崖限当道者，世皆谓之天门云。道中迷雾冰滑，磴几不可登。及既上，苍山负雪，明烛天南。望晚日照城郭，汶水、徂徕如画，而半山居雾若带然。</p>
<p>戊申晦，五鼓，与子颍坐日观亭，待日出。大风扬积雪击面。亭东自足下皆云漫。稍见云中白若樗蒱数十立者，山也。极天云一线异色，须臾成五采。日上，正赤如丹，下有红光动摇承之。或曰，此东海也。回视日观以西峰，或得日或否，绛皓驳色，而皆若偻。</p>
<p>亭西有岱祠，又有碧霞元君祠。皇帝行宫在碧霞元君祠东。是日观道中石刻，自唐显庆以来；其远古刻尽漫失。僻不当道者，皆不及往。</p>
<p>山多石，少土。石苍黑色，多平方，少圜。少杂树，多松，生石罅，皆平顶。冰雪，无瀑水，无鸟兽音迹。至日观数里内无树，而雪与人膝齐。</p>
<p>桐城姚鼐记。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221202-fontfamily-sansa-serif-notfound解决方法"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/02/20221202-fontfamily-sansa-serif-notfound%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"
    >20221202-fontfamily-sansa-serif-notfound解决方法</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/02/20221202-fontfamily-sansa-serif-notfound%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2022-12-02T09:11:31.000Z" itemprop="datePublished">2022-12-02</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><p>删除 缓存路径 <code>C:\Users\ASUS\.matplotlib</code><br>刷新即可</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221201-python字符串数组转浮点数组"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/12/01/20221201-python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E8%BD%AC%E6%B5%AE%E7%82%B9%E6%95%B0%E7%BB%84/"
    >20221201-python字符串数组转浮点数组</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/12/01/20221201-python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E8%BD%AC%E6%B5%AE%E7%82%B9%E6%95%B0%E7%BB%84/" class="article-date">
  <time datetime="2022-12-01T12:44:24.000Z" itemprop="datePublished">2022-12-01</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>12月11日 完成初稿 Chang Liu<a href="mailto:&#x43;&#x68;&#97;&#110;&#x67;&#x2e;&#76;&#x69;&#117;&#x40;&#x72;&#x65;&#115;&#111;&#x6e;&#97;&#x6e;&#x7a;&#x63;&#x61;&#112;&#105;&#x74;&#97;&#x6c;&#46;&#x63;&#x6f;&#x6d;">&#x43;&#x68;&#97;&#110;&#x67;&#x2e;&#76;&#x69;&#117;&#x40;&#x72;&#x65;&#115;&#111;&#x6e;&#97;&#x6e;&#x7a;&#x63;&#x61;&#112;&#105;&#x74;&#97;&#x6c;&#46;&#x63;&#x6f;&#x6d;</a> 费用: 3000 记录好 有个新的样式要做</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="string">&#x27;22&#x27;</span>,<span class="string">&#x27;44&#x27;</span>,<span class="string">&#x27;66&#x27;</span>,<span class="string">&#x27;88&#x27;</span>]</span><br><span class="line"></span><br><span class="line">arr = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">float</span>,arr))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"></span><br><span class="line">[<span class="number">22</span>, <span class="number">44</span>, <span class="number">66</span>, <span class="number">88</span>]</span><br></pre></td></tr></table></figure>

<h2 id="python-matplotlib-画廊-gallery"><a href="#python-matplotlib-画廊-gallery" class="headerlink" title="python matplotlib 画廊 gallery"></a>python matplotlib 画廊 gallery</h2><p><a target="_blank" rel="noopener" href="https://www.matplotlib.org.cn/gallery/#lines-bars-and-markers">https://www.matplotlib.org.cn/gallery/#lines-bars-and-markers</a></p>
<h2 id="matplotlib中文文档"><a href="#matplotlib中文文档" class="headerlink" title="matplotlib中文文档"></a>matplotlib中文文档</h2><p><a target="_blank" rel="noopener" href="http://www.matplotlib.org.cn/">www.matplotlib.org.cn/</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221130-eps32wifi协议"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/30/20221130-eps32wifi%E5%8D%8F%E8%AE%AE/"
    >20221130-eps32wifi协议</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/30/20221130-eps32wifi%E5%8D%8F%E8%AE%AE/" class="article-date">
  <time datetime="2022-11-30T11:08:37.000Z" itemprop="datePublished">2022-11-30</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>router<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dd4y1B7RT">https://www.bilibili.com/video/BV1Dd4y1B7RT</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21951093">https://zhuanlan.zhihu.com/p/21951093</a></p>
<p>802.11 协议精读19 wifi 的起源，诞生与发展</p>
<p>本来这一节打算开始讨论802.11e的内容，因为从无线局域网诞生到成型，尤其是演进的过程中，一个重要的起步点就是802.11e，很多在802.11n，802.11ac，802.11ah之中所引入的内容，实际上在802.11e中都可以发现其的引导，更一般而言，先行的802.11的MAC层协议基本都是按照802.11e中的EDCF，而不是传统的DCF。</p>
<p>然而，如果直接从802.11e开始谈及802.11协议的演进也有点冲突，因为从协议开始之初，或者说协议开始之前，实际上就一直处于演进的过程。所以本文就笔者个人所了解的部分，梳理下无线局域网协议WLAN的大致演进过程。</p>
<p>本文中的一些内容部分参考自下述引文：</p>
<p>《The Innovation Journey of Wi-Fi (The Road to Global Success)》<br>“THE HISTORY OF WI-FI”<br>《Ethernet:The Definitive Guide》</p>
<p>wifi 协议的起源</p>
<p>wifi 是一种WLAN 协议，即无线局域网协议，其历史或者说网络协议中的多地址接入协议的历史都可以追述到1971 年的ALOHAnet</p>
<p>Aloha协议的思想如下：“一个aloha节点只要有数据的话，该节点就可以立即发送。当该节点数据发送完之后，其需要等待接收方反馈的ACK。若成功接收到ACK之后，那么这一次传输成功。如果没有收到ACK的话，那么这一次传输失败。该aloha节点会认为网络中还存在另外一个aloha节点也在发送数据，所以造成接收方发生了冲突。最后这些冲突的节点会随机选择一个时间进行回退（backoff），以避免下一次冲突。若冲突节点回退完成，其才可以重新进行发送”。</p>
<p>CSMA&#x2F;CD协议的思想如下：“节点发送数据之前需要持续监听信道，一旦节点发现信道空闲，则立刻发送数据，<br>。在发送数据的同时，节点持续监听信道，”探测” 是否有别的节点也在该时刻发送数据。<br>若传输过程中没有检测到别的节点的传输，那么成功传输。在成功传输后，节点需要等待帧间间隔IFG（interframe gap）时间后，可以进行下一次传输。<br>若在传输过程中，探测到别的节点也在传输，那么则检测到冲突。发生冲突后，节点立刻停止当前的传输，并且发送特定的干扰序列（JAM序列），用以加强该次冲突（用以保证其余所有节点都检测到该次冲突），在JAM序列发送完之后，节点随机选择一个时间倒数进行backoff。当backoff完成之后，节点可以尝试再次重传”。</p>
<p>IEEE 802 委员会所颁布的标准体系比较完善，其设置了多个不同的Group 用来指定不同场景下对应的协议</p>
<p>在网络发展中，无线通信不仅仅是无线局域网这一条发展脉络，其最主要的还是通信网络，不过由于本文仅仅是讨论无线局域网，对于通信网络的发展，笔者涉猎优先，所以不进行开展</p>
<p>民用网络的发展往往首先要通过政策许可这一关，在网络发展的起源地美国，其政策指的即是美国联邦通信委员会 (US Federal Communications Commission，FCC) 所派发的牌照（即无线电频段的使用许可）。考虑到避免干扰雷达所使用的无线电频段，于1985年，FCC颁发了为工业（industrial）、科学（scientific）和医疗（medical）行业颁发了ISM牌照，这一次的频段许可开放了900MHz，2.4GHz，和5.8GHz这三个频段，当时仅仅允许节点采用扩频技术（spread-spectrum）来进行通信。</p>
<p>在ISM 频段之前，无线通信，比如无线广播以及电视广播都是采用专用的频段，这可以避免一些有害无线电干扰，而ism 频段之所以选择这些频段，是对于主要业务不重要，同时也是容易受到无线电干扰的频段</p>
<p>MAC层初始设计时就存在两种声音，一种是由IBM所代表的中心式控制（Merits of Central），一种是由NCR代表（包含NCR&#x2F;Symbol Technologies&#x2F;Xircom）所代表的分布式控制（Distributed Control Architecture）。最终是由NCR所代表的分布式控制思路获得初步的胜利。从笔者的角度而言，这也是后来在Wi-Fi协议，始终存在分布式（DCF，EDCA）和中心式（PCF，HCCA）兼容设计的开始。<br>PHY的初始设计中包含两种可能的扩频方式，跳频（Frequency Hopping）和直序扩频（Direct Sequence）。 这也是由于FCC一开始发放的ISM牌照，其仅仅允许扩频通信的方案存在。在协议设计之初，团队就无法在两者中仅仅取决一种，所以在初始协议最终颁布时，两种物理层扩频方案都是被支持的。</p>
<p>当下的hotspot 更强调的是一共为公共区域提供网络服务的热点业务，而最初hotspot 就是我们当前无线局域网基础架构模式，即存在一个无线AP 然后通过其连接如公网的架构</p>
<p>hotspot 的概念也是wifi 协议能够成功的关键因素之一，其是wifi 在商业应用中最重要的组成部分之一，hotspot 的需求也大大推进了wifi 协议的发展，其中的漫游 安全  多AP 扩展的ESS 模式也都是由此发展而来的</p>
<p>实际上大家开始接触wifi 很多也是从802.11b 开始的，802.11b 是802.11 协议中的第一个里程碑，早期的带wifi 功能的笔记本，或者PSP游戏机，其所带的无线功能都是基于802.11b的 </p>
<p>802.11a引入了一种新的物理层技术OFDM（Orthogonal Frequency Division Multiplexing）。OFDM技术是于20世纪60年代就提出的，但是当时其核心算法FFT复杂度较高，随着集成电路技术的发展，到90年代时OFDM技术开始通信工程具体采用。相比扩频技术，OFDM技术有更高的频谱利用率。如上图所示，OFDM是通过时频关系的映射，将多个数字信号搭载到多个频域子载波上（如上图所示），然后通过IFFT合成，将这些数字信号一次性发送出去。通过OFDM，能够获得更高的频谱利用率，提高传输速率。对于OFDM的细节，我们也会在以后进行展开，这里就不详细展开了。</p>
<p>802.11a当时没有受到很好的效果，主要还是频段的问题。因为当时FCC仅在5GHz频段上开放了OFDM技术，据《Next Generation Wireless LANs.802.11n and 802.11ac》一书所言，在1999~2000年间，美国非军事使用的5G频段仅仅只有几个指定的信道。而且由于802.11a和802.11b所在频段不同，所以新出的设备要同时兼容802.11b和802.11a就会造成成本增加，所以实际802.11a的实际应用很少。</p>
<p>当初实际上也是FCC 不允许在2.4GHz 频段上使用OFDM 技术，仅仅只允许扩频技术</p>
<p>2.4GHz 频段上也可以使用OFDM 技术</p>
<p>在2004年时，由于传统Wi-Fi的发展都在于其PHY层和MAC层的性能上，协议的安全性并没有得到很好的保证。故在04年时，专门针对Wi-Fi安全的协议标准802.11i正式颁布，实际上，这个时期也有一个中国尝试发起的协议WAPI，也是针对该问题而言的。</p>
<p>802.11n 的核心技术概念是MIMO 之前的无线通信我们都是单天线的传输系统，在mimo 的设计上，我们可以通过多根天线，并行传输多个不同数据，从而提高传输速率，提供更高的系统带宽</p>
<p>实际上在网络发展中，各个不同源头的技术实际上是时有交互的，然而，是否成功，还是要根据市场和时机的检验，<br>好比wifi 虽然获得了比较大的成功，而wimax 则没有被广泛采用</p>
<p>在2010年时候，在时任美国总统奥巴马的支持下，FCC同意在未来增加500MHz新频段用以无线通信，该500MHz是分散在多个不同的频段下，具体是根据具体的功能需求进行的设定。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-20221129-大疆模拟器键盘表示"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/29/20221129-%E5%A4%A7%E7%96%86%E6%A8%A1%E6%8B%9F%E5%99%A8%E9%94%AE%E7%9B%98%E8%A1%A8%E7%A4%BA/"
    >20221129-大疆模拟器键盘表示</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/29/20221129-%E5%A4%A7%E7%96%86%E6%A8%A1%E6%8B%9F%E5%99%A8%E9%94%AE%E7%9B%98%E8%A1%A8%E7%A4%BA/" class="article-date">
  <time datetime="2022-11-29T12:11:38.000Z" itemprop="datePublished">2022-11-29</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="DJI-Lightbridge-遥控器"><a href="#DJI-Lightbridge-遥控器" class="headerlink" title="DJI Lightbridge 遥控器"></a>DJI Lightbridge 遥控器</h2><p>拍照 小地图 （长按）</p>
<p>飞行模式</p>
<p>切换视角  切换控制（长按）</p>
<p>自定义菜单</p>
<p>自动返航<br>中断返航<br>飞行模式<br>轨迹开关（长按） 录像&#x2F;停止  跳跃</p>
<p>云台角度</p>
<p>暂停 介绍面板（长按）</p>
<h2 id="DJI-Mavic-Air-遥控器"><a href="#DJI-Mavic-Air-遥控器" class="headerlink" title="DJI Mavic Air 遥控器"></a>DJI Mavic Air 遥控器</h2><p>自动返航（长按）  中断返航</p>
<p>暂停  介绍面板（长按）</p>
<p>飞行模式</p>
<p>自定义菜单</p>
<p>拍照  小地图（长按）</p>
<p>切换视角  切换控制（长按）</p>
<p>录像</p>
<p>轨迹开关（长按）  跳跃</p>
<p>云台角度</p>
<h2 id="DJI-Cendence-S"><a href="#DJI-Cendence-S" class="headerlink" title="DJI Cendence S"></a>DJI Cendence S</h2><p>录像&#x2F;停止 轨迹开关（长按） 跳跃</p>
<p>拍照 小地图（长按）</p>
<p>切换视角  切换控制（长按）</p>
<p>自定义菜单</p>
<p>飞行模式</p>
<p>云台角度</p>
<p>暂停  介绍面板（长按）</p>
<h2 id="DJI-T16-遥控器"><a href="#DJI-T16-遥控器" class="headerlink" title="DJI T16 遥控器"></a>DJI T16 遥控器</h2><p>拍照 小地图（长按）</p>
<p>切换视角  切换控制（长按）</p>
<p>自定义菜单</p>
<p>录像&#x2F;停止<br>轨迹开关（长按）<br>跳跃<br>喷洒农药</p>
<p>暂停 介绍面板（长按）</p>
<h2 id="DJI-带屏遥控器"><a href="#DJI-带屏遥控器" class="headerlink" title="DJI 带屏遥控器"></a>DJI 带屏遥控器</h2><p>自动返航（长按） 中断返航</p>
<p>切换视角 切换控制（长按）</p>
<p>飞行模式</p>
<p>拍照  小地图（长按）</p>
<p>自定义菜单</p>
<p>录像&#x2F;停止  轨迹开关（长按） 跳跃</p>
<p>云台角度</p>
<p>暂停 介绍面板（长按）</p>
<p>键盘</p>
<p>暂停 P<br>拍照 H<br>录像&#x2F;停止 L<br>轨迹开关 space<br>自动返航&#x2F;中断返航 O<br>跳跃 Space<br>自定义菜单 Enter</p>
<p>云台上转 R<br>云台下转 F<br>切换视角 C<br>飞行模式 V<br>切换控制 J<br>小地图 M<br>介绍面板 I</p>
<h2 id="摇杆模式"><a href="#摇杆模式" class="headerlink" title="摇杆模式"></a>摇杆模式</h2><h3 id="日本手"><a href="#日本手" class="headerlink" title="日本手"></a>日本手</h3><p>左逆时针  前进 左转 后退 右转<br>右逆时针  上升 左飞 下降 右飞</p>
<h3 id="美国手"><a href="#美国手" class="headerlink" title="美国手"></a>美国手</h3><p>左逆时针  上升 左转 下降 右转<br>右逆时针  前进 左飞 后退 右飞</p>
<h3 id="中国手"><a href="#中国手" class="headerlink" title="中国手"></a>中国手</h3><p>左逆时针  前进 左飞 后退 右飞<br>右逆时针  上升 左转 下降 右转</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/12/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/14/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2023
        <i class="ri-heart-fill heart_icon"></i> TeX_baitu
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="TeX_baitu blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>